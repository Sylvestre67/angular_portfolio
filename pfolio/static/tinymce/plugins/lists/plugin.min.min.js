tinymce.PluginManager.add("lists",function(l){var i=this;function n(a){return a&&(/^(OL|UL|DL)$/).test(a.nodeName)}function m(a){return a.parentNode.firstChild==a}function j(a){return a.parentNode.lastChild==a}function k(a){return a&&!!l.schema.getTextBlockElements()[a.nodeName]}function h(a){return a===l.getBody()}l.on("init",function(){var f=l.dom,a=l.selection;function A(q,o){var p=f.isEmpty(q);if(o&&f.select("span[data-mce-type=bookmark]").length>0){return false}return p}function D(p){var o={};function q(r){var t,u,s;u=p[r?"startContainer":"endContainer"];s=p[r?"startOffset":"endOffset"];if(u.nodeType==1){t=f.create("span",{"data-mce-type":"bookmark"});if(u.hasChildNodes()){s=Math.min(s,u.childNodes.length-1);if(r){u.insertBefore(t,u.childNodes[s])}else{f.insertAfter(t,u.childNodes[s])}}else{u.appendChild(t)}u=t;s=0}o[r?"startContainer":"endContainer"]=u;o[r?"startOffset":"endOffset"]=s}q(true);if(!p.collapsed){q()}return o}function H(o){function q(r){var v,t,u;function s(x){var w=x.parentNode.firstChild,y=0;while(w){if(w==x){return y}if(w.nodeType!=1||w.getAttribute("data-mce-type")!="bookmark"){y++}w=w.nextSibling}return -1}v=u=o[r?"startContainer":"endContainer"];t=o[r?"startOffset":"endOffset"];if(!v){return}if(v.nodeType==1){t=s(v);v=v.parentNode;f.remove(u)}o[r?"startContainer":"endContainer"]=v;o[r?"startOffset":"endOffset"]=t}q(true);q();var p=f.createRng();p.setStart(o.startContainer,o.startOffset);if(o.endContainer){p.setEnd(o.endContainer,o.endOffset)}a.setRng(p)}function J(u,s){var q,o,t=f.createFragment(),v;var r=l.schema.getBlockElements();if(l.settings.forced_root_block){s=s||l.settings.forced_root_block}if(s){o=f.create(s);if(o.tagName===l.settings.forced_root_block){f.setAttribs(o,l.settings.forced_root_block_attrs)}t.appendChild(o)}if(u){while((q=u.firstChild)){var p=q.nodeName;if(!v&&(p!="SPAN"||q.getAttribute("data-mce-type")!="bookmark")){v=true}if(r[p]){t.appendChild(q);o=null}else{if(s){if(!o){o=f.create(s);t.appendChild(o)}o.appendChild(q)}else{t.appendChild(q)}}}}if(!l.settings.forced_root_block){t.appendChild(f.create("br"))}else{if(!v&&(!tinymce.Env.ie||tinymce.Env.ie>10)){o.appendChild(f.create("br",{"data-mce-bogus":"1"}))}}return t}function c(){return tinymce.grep(a.getSelectedBlocks(),function(o){return/^(LI|DT|DD)$/.test(o.nodeName)})}function g(u,t,p){var v,o,s,r;function q(w){tinymce.each(s,function(x){w.parentNode.insertBefore(x,t.parentNode)});f.remove(w)}s=f.select('span[data-mce-type="bookmark"]',u);p=p||J(t);v=f.createRng();v.setStartAfter(t);v.setEndAfter(u);o=v.extractContents();for(r=o.firstChild;r;r=r.firstChild){if(r.nodeName=="LI"&&f.isEmpty(r)){f.remove(r);break}}if(!f.isEmpty(o)){f.insertAfter(o,u)}f.insertAfter(p,u);if(A(t.parentNode)){q(t.parentNode)}f.remove(t);if(A(u)){f.remove(u)}}function b(p){var o,q;o=p.nextSibling;if(o&&n(o)&&o.nodeName==p.nodeName){while((q=o.firstChild)){p.appendChild(q)}f.remove(o)}o=p.previousSibling;if(o&&n(o)&&o.nodeName==p.nodeName){while((q=o.firstChild)){p.insertBefore(q,p.firstChild)}f.remove(o)}}function G(o){tinymce.each(tinymce.grep(f.select("ol,ul",o)),function(r){var q,p=r.parentNode;if(p.nodeName=="LI"&&p.firstChild==r){q=p.previousSibling;if(q&&q.nodeName=="LI"){q.appendChild(r);if(A(p)){f.remove(p)}}}if(n(p)){q=p.previousSibling;if(q&&q.nodeName=="LI"){q.appendChild(r)}}})}function B(o){var s=o.parentNode,r=s.parentNode,p;function q(t){if(A(t)){f.remove(t)}}if(h(s)){return true}if(o.nodeName=="DD"){f.rename(o,"DT");return true}if(m(o)&&j(o)){if(r.nodeName=="LI"){f.insertAfter(o,r);q(r);f.remove(s)}else{if(n(r)){f.remove(s,true)}else{r.insertBefore(J(o),s);f.remove(s)}}return true}else{if(m(o)){if(r.nodeName=="LI"){f.insertAfter(o,r);o.appendChild(s);q(r)}else{if(n(r)){r.insertBefore(o,s)}else{r.insertBefore(J(o),s);f.remove(o)}}return true}else{if(j(o)){if(r.nodeName=="LI"){f.insertAfter(o,r)}else{if(n(r)){f.insertAfter(o,s)}else{f.insertAfter(J(o),s);f.remove(o)}}return true}}}if(r.nodeName=="LI"){s=r;p=J(o,"LI")}else{if(n(r)){p=J(o,"LI")}else{p=J(o)}}g(s,o,p);G(s.parentNode);return true}function C(q){var r,o;function p(s,t){var u;if(n(s)){while((u=q.lastChild.firstChild)){t.appendChild(u)}f.remove(s)}}if(q.nodeName=="DT"){f.rename(q,"DD");return true}r=q.previousSibling;if(r&&n(r)){r.appendChild(q);return true}if(r&&r.nodeName=="LI"&&n(r.lastChild)){r.lastChild.appendChild(q);p(q.lastChild,r.lastChild);return true}r=q.nextSibling;if(r&&n(r)){r.insertBefore(q,r.firstChild);return true}if(r&&r.nodeName=="LI"&&n(q.lastChild)){return false}r=q.previousSibling;if(r&&r.nodeName=="LI"){o=f.create(q.parentNode.nodeName);r.appendChild(o);o.appendChild(q);p(q.lastChild,o);return true}return false}function z(){var o=c();if(o.length){var q=D(a.getRng(true));for(var p=0;p<o.length;p++){if(!C(o[p])&&p===0){break}}H(q);l.nodeChanged();return true}}function E(){var t=c();if(t.length){var s=D(a.getRng(true));var o,p,r=l.getBody();o=t.length;while(o--){var q=t[o].parentNode;while(q&&q!=r){p=t.length;while(p--){if(t[p]===q){t.splice(o,1);break}}q=q.parentNode}}for(o=0;o<t.length;o++){if(!B(t[o])&&o===0){break}}H(s);l.nodeChanged();return true}}function e(s){var o=a.getRng(true),p,r="LI";if(f.getContentEditable(a.getNode())==="false"){return}s=s.toUpperCase();if(s=="DL"){r="DT"}function q(){var v=[],M=l.getBody();function x(K){var P,L;P=o[K?"startContainer":"endContainer"];L=o[K?"startOffset":"endOffset"];if(P.nodeType==1){P=P.childNodes[Math.min(L,P.childNodes.length-1)]||P}while(P.parentNode!=M){if(k(P)){return P}if(/^(TD|TH)$/.test(P.parentNode.nodeName)){return P}P=P.parentNode}return P}var y=x(true);var N=x();var t,u=[];for(var w=y;w;w=w.nextSibling){u.push(w);if(w==N){break}}tinymce.each(u,function(L){if(k(L)){v.push(L);t=null;return}if(f.isBlock(L)||L.nodeName=="BR"){if(L.nodeName=="BR"){f.remove(L)}t=null;return}var K=L.nextSibling;if(tinymce.dom.BookmarkManager.isBookmarkNode(L)){if(k(K)||(!K&&L.parentNode==M)){t=null;return}}if(!t){t=f.create("p");L.parentNode.insertBefore(t,L);v.push(t)}t.appendChild(L)});return v}p=D(o);tinymce.each(q(),function(t){var v,u;u=t.previousSibling;if(u&&n(u)&&u.nodeName==s){v=u;t=f.rename(t,r);u.appendChild(t)}else{v=f.create(s);t.parentNode.insertBefore(v,t);v.appendChild(t);t=f.rename(t,r)}b(v)});H(p)}function d(){var o=D(a.getRng(true)),p=l.getBody();tinymce.each(c(),function(s){var q,r;if(h(s.parentNode)){return}if(A(s)){B(s);return}for(q=s;q&&q!=p;q=q.parentNode){if(n(q)){r=q}}g(r,s)});H(o)}function F(o){var p=f.getParent(a.getStart(),"OL,UL,DL");if(h(p)){return}if(p){if(p.nodeName==o){d(o)}else{var q=D(a.getRng(true));b(f.rename(p,o));H(q)}}else{e(o)}}function I(o){return function(){var p=f.getParent(l.selection.getStart(),"UL,OL,DL");return p&&p.nodeName==o}}i.backspaceDelete=function(r){function q(N,x){var y=N.startContainer,P=N.startOffset;var O,w;if(y.nodeType==3&&(x?P<y.data.length:P>0)){return y}O=l.schema.getNonEmptyElements();w=new tinymce.dom.TreeWalker(N.startContainer);while((y=w[x?"next":"prev"]())){if(y.nodeName=="LI"&&!y.hasChildNodes()){return y}if(O[y.nodeName]){return y}if(y.nodeType==3&&y.data.length>0){return y}}}function p(M,w){var x,y,N=M.parentNode;if(n(w.lastChild)){y=w.lastChild}x=w.lastChild;if(x&&x.nodeName=="BR"&&M.hasChildNodes()){f.remove(x)}if(A(w,true)){f.$(w).empty()}if(!A(M,true)){while((x=M.firstChild)){w.appendChild(x)}}if(y){w.appendChild(y)}f.remove(M);if(A(N)&&!h(N)){f.remove(N)}}if(a.isCollapsed()){var u=f.getParent(a.getStart(),"LI"),t,v,o;if(u){t=u.parentNode;if(h(t)&&f.isEmpty(t)){return true}v=a.getRng(true);o=f.getParent(q(v,r),"LI");if(o&&o!=u){var s=D(v);if(r){p(o,u)}else{p(u,o)}H(s);return true}else{if(!o){if(!r&&d(t.nodeName)){return true}}}}}};l.on("BeforeExecCommand",function(q){var o=q.command.toLowerCase(),p;if(o=="indent"){if(z()){p=true}}else{if(o=="outdent"){if(E()){p=true}}}if(p){l.fire("ExecCommand",{command:q.command});q.preventDefault();return true}});l.addCommand("InsertUnorderedList",function(){F("UL")});l.addCommand("InsertOrderedList",function(){F("OL")});l.addCommand("InsertDefinitionList",function(){F("DL")});l.addQueryStateHandler("InsertUnorderedList",I("UL"));l.addQueryStateHandler("InsertOrderedList",I("OL"));l.addQueryStateHandler("InsertDefinitionList",I("DL"));l.on("keydown",function(o){if(o.keyCode!=9||tinymce.util.VK.metaKeyPressed(o)){return}if(l.dom.getParent(l.selection.getStart(),"LI,DT,DD")){o.preventDefault();if(o.shiftKey){E()}else{z()}}})});l.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(){var a=this;l.on("nodechange",function(){var e=l.selection.getSelectedBlocks();var b=false;for(var f=0,c=e.length;!b&&f<c;f++){var d=e[f].nodeName;b=(d=="LI"&&m(e[f])||d=="UL"||d=="OL"||d=="DD")}a.disabled(b)})}});l.on("keydown",function(a){if(a.keyCode==tinymce.util.VK.BACKSPACE){if(i.backspaceDelete()){a.preventDefault()}}else{if(a.keyCode==tinymce.util.VK.DELETE){if(i.backspaceDelete(true)){a.preventDefault()}}}})});