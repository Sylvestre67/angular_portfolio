tinymce.PluginManager.add("lists",function(e){var a=this;function c(h){return h&&(/^(OL|UL|DL)$/).test(h.nodeName)}function d(h){return h.parentNode.firstChild==h}function g(h){return h.parentNode.lastChild==h}function f(h){return h&&!!e.schema.getTextBlockElements()[h.nodeName]}function b(h){return h===e.getBody()}e.on("init",function(){var t=e.dom,y=e.selection;function q(B,A){var z=t.isEmpty(B);if(A&&t.select("span[data-mce-type=bookmark]").length>0){return false}return z}function n(z){var A={};function B(F){var D,C,E;C=z[F?"startContainer":"endContainer"];E=z[F?"startOffset":"endOffset"];if(C.nodeType==1){D=t.create("span",{"data-mce-type":"bookmark"});if(C.hasChildNodes()){E=Math.min(E,C.childNodes.length-1);if(F){C.insertBefore(D,C.childNodes[E])}else{t.insertAfter(D,C.childNodes[E])}}else{C.appendChild(D)}C=D;E=0}A[F?"startContainer":"endContainer"]=C;A[F?"startOffset":"endOffset"]=E}B(true);if(!z.collapsed){B()}return A}function j(A){function B(G){var C,E,D;function F(I){var J=I.parentNode.firstChild,H=0;while(J){if(J==I){return H}if(J.nodeType!=1||J.getAttribute("data-mce-type")!="bookmark"){H++}J=J.nextSibling}return -1}C=D=A[G?"startContainer":"endContainer"];E=A[G?"startOffset":"endOffset"];if(!C){return}if(C.nodeType==1){E=F(C);C=C.parentNode;t.remove(D)}A[G?"startContainer":"endContainer"]=C;A[G?"startOffset":"endOffset"]=E}B(true);B();var z=t.createRng();z.setStart(A.startContainer,A.startOffset);if(A.endContainer){z.setEnd(A.endContainer,A.endOffset)}y.setRng(z)}function h(z,D){var F,A,C=t.createFragment(),B;var E=e.schema.getBlockElements();if(e.settings.forced_root_block){D=D||e.settings.forced_root_block}if(D){A=t.create(D);if(A.tagName===e.settings.forced_root_block){t.setAttribs(A,e.settings.forced_root_block_attrs)}C.appendChild(A)}if(z){while((F=z.firstChild)){var G=F.nodeName;if(!B&&(G!="SPAN"||F.getAttribute("data-mce-type")!="bookmark")){B=true}if(E[G]){C.appendChild(F);A=null}else{if(D){if(!A){A=t.create(D);C.appendChild(A)}A.appendChild(F)}else{C.appendChild(F)}}}}if(!e.settings.forced_root_block){C.appendChild(t.create("br"))}else{if(!B&&(!tinymce.Env.ie||tinymce.Env.ie>10)){A.appendChild(t.create("br",{"data-mce-bogus":"1"}))}}return C}function w(){return tinymce.grep(y.getSelectedBlocks(),function(z){return/^(LI|DT|DD)$/.test(z.nodeName)})}function s(C,z,G){var B,A,D,E;function F(H){tinymce.each(D,function(I){H.parentNode.insertBefore(I,z.parentNode)});t.remove(H)}D=t.select('span[data-mce-type="bookmark"]',C);G=G||h(z);B=t.createRng();B.setStartAfter(z);B.setEndAfter(C);A=B.extractContents();for(E=A.firstChild;E;E=E.firstChild){if(E.nodeName=="LI"&&t.isEmpty(E)){t.remove(E);break}}if(!t.isEmpty(A)){t.insertAfter(A,C)}t.insertAfter(G,C);if(q(z.parentNode)){F(z.parentNode)}t.remove(z);if(q(C)){t.remove(C)}}function x(z){var A,B;A=z.nextSibling;if(A&&c(A)&&A.nodeName==z.nodeName){while((B=A.firstChild)){z.appendChild(B)}t.remove(A)}A=z.previousSibling;if(A&&c(A)&&A.nodeName==z.nodeName){while((B=A.firstChild)){z.insertBefore(B,z.firstChild)}t.remove(A)}}function k(z){tinymce.each(tinymce.grep(t.select("ol,ul",z)),function(B){var C,A=B.parentNode;if(A.nodeName=="LI"&&A.firstChild==B){C=A.previousSibling;if(C&&C.nodeName=="LI"){C.appendChild(B);if(q(A)){t.remove(A)}}}if(c(A)){C=A.previousSibling;if(C&&C.nodeName=="LI"){C.appendChild(B)}}})}function p(A){var B=A.parentNode,z=B.parentNode,D;function C(E){if(q(E)){t.remove(E)}}if(b(B)){return true}if(A.nodeName=="DD"){t.rename(A,"DT");return true}if(d(A)&&g(A)){if(z.nodeName=="LI"){t.insertAfter(A,z);C(z);t.remove(B)}else{if(c(z)){t.remove(B,true)}else{z.insertBefore(h(A),B);t.remove(B)}}return true}else{if(d(A)){if(z.nodeName=="LI"){t.insertAfter(A,z);A.appendChild(B);C(z)}else{if(c(z)){z.insertBefore(A,B)}else{z.insertBefore(h(A),B);t.remove(A)}}return true}else{if(g(A)){if(z.nodeName=="LI"){t.insertAfter(A,z)}else{if(c(z)){t.insertAfter(A,B)}else{t.insertAfter(h(A),B);t.remove(A)}}return true}}}if(z.nodeName=="LI"){B=z;D=h(A,"LI")}else{if(c(z)){D=h(A,"LI")}else{D=h(A)}}s(B,A,D);k(B.parentNode);return true}function o(z){var B,A;function C(F,E){var D;if(c(F)){while((D=z.lastChild.firstChild)){E.appendChild(D)}t.remove(F)}}if(z.nodeName=="DT"){t.rename(z,"DD");return true}B=z.previousSibling;if(B&&c(B)){B.appendChild(z);return true}if(B&&B.nodeName=="LI"&&c(B.lastChild)){B.lastChild.appendChild(z);C(z.lastChild,B.lastChild);return true}B=z.nextSibling;if(B&&c(B)){B.insertBefore(z,B.firstChild);return true}if(B&&B.nodeName=="LI"&&c(z.lastChild)){return false}B=z.previousSibling;if(B&&B.nodeName=="LI"){A=t.create(z.parentNode.nodeName);B.appendChild(A);A.appendChild(z);C(z.lastChild,A);return true}return false}function r(){var A=w();if(A.length){var B=n(y.getRng(true));for(var z=0;z<A.length;z++){if(!o(A[z])&&z===0){break}}j(B);e.nodeChanged();return true}}function m(){var B=w();if(B.length){var C=n(y.getRng(true));var A,E,z=e.getBody();A=B.length;while(A--){var D=B[A].parentNode;while(D&&D!=z){E=B.length;while(E--){if(B[E]===D){B.splice(A,1);break}}D=D.parentNode}}for(A=0;A<B.length;A++){if(!p(B[A])&&A===0){break}}j(C);e.nodeChanged();return true}}function u(B){var A=y.getRng(true),D,C="LI";if(t.getContentEditable(y.getNode())==="false"){return}B=B.toUpperCase();if(B=="DL"){C="DT"}function z(){var J=[],F=e.getBody();function H(O){var M,N;M=A[O?"startContainer":"endContainer"];N=A[O?"startOffset":"endOffset"];if(M.nodeType==1){M=M.childNodes[Math.min(N,M.childNodes.length-1)]||M}while(M.parentNode!=F){if(f(M)){return M}if(/^(TD|TH)$/.test(M.parentNode.nodeName)){return M}M=M.parentNode}return M}var G=H(true);var E=H();var L,K=[];for(var I=G;I;I=I.nextSibling){K.push(I);if(I==E){break}}tinymce.each(K,function(M){if(f(M)){J.push(M);L=null;return}if(t.isBlock(M)||M.nodeName=="BR"){if(M.nodeName=="BR"){t.remove(M)}L=null;return}var N=M.nextSibling;if(tinymce.dom.BookmarkManager.isBookmarkNode(M)){if(f(N)||(!N&&M.parentNode==F)){L=null;return}}if(!L){L=t.create("p");M.parentNode.insertBefore(L,M);J.push(L)}L.appendChild(M)});return J}D=n(A);tinymce.each(z(),function(G){var E,F;F=G.previousSibling;if(F&&c(F)&&F.nodeName==B){E=F;G=t.rename(G,C);F.appendChild(G)}else{E=t.create(B);G.parentNode.insertBefore(E,G);E.appendChild(G);G=t.rename(G,C)}x(E)});j(D)}function v(){var A=n(y.getRng(true)),z=e.getBody();tinymce.each(w(),function(B){var D,C;if(b(B.parentNode)){return}if(q(B)){p(B);return}for(D=B;D&&D!=z;D=D.parentNode){if(c(D)){C=D}}s(C,B)});j(A)}function l(A){var z=t.getParent(y.getStart(),"OL,UL,DL");if(b(z)){return}if(z){if(z.nodeName==A){v(A)}else{var B=n(y.getRng(true));x(t.rename(z,A));j(B)}}else{u(A)}}function i(z){return function(){var A=t.getParent(e.selection.getStart(),"UL,OL,DL");return A&&A.nodeName==z}}a.backspaceDelete=function(E){function F(I,K){var J=I.startContainer,M=I.startOffset;var H,L;if(J.nodeType==3&&(K?M<J.data.length:M>0)){return J}H=e.schema.getNonEmptyElements();L=new tinymce.dom.TreeWalker(I.startContainer);while((J=L[K?"next":"prev"]())){if(J.nodeName=="LI"&&!J.hasChildNodes()){return J}if(H[J.nodeName]){return J}if(J.nodeType==3&&J.data.length>0){return J}}}function G(I,L){var K,J,H=I.parentNode;if(c(L.lastChild)){J=L.lastChild}K=L.lastChild;if(K&&K.nodeName=="BR"&&I.hasChildNodes()){t.remove(K)}if(q(L,true)){t.$(L).empty()}if(!q(I,true)){while((K=I.firstChild)){L.appendChild(K)}}if(J){L.appendChild(J)}t.remove(I);if(q(H)&&!b(H)){t.remove(H)}}if(y.isCollapsed()){var z=t.getParent(y.getStart(),"LI"),C,B,A;if(z){C=z.parentNode;if(b(C)&&t.isEmpty(C)){return true}B=y.getRng(true);A=t.getParent(F(B,E),"LI");if(A&&A!=z){var D=n(B);if(E){G(A,z)}else{G(z,A)}j(D);return true}else{if(!A){if(!E&&v(C.nodeName)){return true}}}}}};e.on("BeforeExecCommand",function(B){var A=B.command.toLowerCase(),z;if(A=="indent"){if(r()){z=true}}else{if(A=="outdent"){if(m()){z=true}}}if(z){e.fire("ExecCommand",{command:B.command});B.preventDefault();return true}});e.addCommand("InsertUnorderedList",function(){l("UL")});e.addCommand("InsertOrderedList",function(){l("OL")});e.addCommand("InsertDefinitionList",function(){l("DL")});e.addQueryStateHandler("InsertUnorderedList",i("UL"));e.addQueryStateHandler("InsertOrderedList",i("OL"));e.addQueryStateHandler("InsertDefinitionList",i("DL"));e.on("keydown",function(z){if(z.keyCode!=9||tinymce.util.VK.metaKeyPressed(z)){return}if(e.dom.getParent(e.selection.getStart(),"LI,DT,DD")){z.preventDefault();if(z.shiftKey){m()}else{r()}}})});e.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(){var h=this;e.on("nodechange",function(){var o=e.selection.getSelectedBlocks();var m=false;for(var n=0,k=o.length;!m&&n<k;n++){var j=o[n].nodeName;m=(j=="LI"&&d(o[n])||j=="UL"||j=="OL"||j=="DD")}h.disabled(m)})}});e.on("keydown",function(h){if(h.keyCode==tinymce.util.VK.BACKSPACE){if(a.backspaceDelete()){h.preventDefault()}}else{if(h.keyCode==tinymce.util.VK.DELETE){if(a.backspaceDelete(true)){h.preventDefault()}}}})});