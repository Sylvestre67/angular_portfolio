(function(b,g){var d={};function c(m,n){var l,j=[];for(var k=0;k<m.length;++k){l=d[m[k]]||e(m[k]);if(!l){throw"module definition dependecy not found: "+m[k]}j.push(l)}n.apply(null,j)}function h(k,j,i){if(typeof k!=="string"){throw"invalid module definition, module id must be defined and be a string"}if(j===g){throw"invalid module definition, dependencies must be specified"}if(i===g){throw"invalid module definition, definition function must be specified"}c(j,function(){d[k]=i.apply(null,arguments)})}function f(i){return !!d[i]}function e(l){var j=b;var i=l.split(/[.\/]/);for(var k=0;k<i.length;++k){if(!j[i[k]]){return}j=j[i[k]]}return j}function a(l){var k,n,p,j,m;for(k=0;k<l.length;k++){n=b;p=l[k];j=p.split(/[.\/]/);for(var o=0;o<j.length-1;++o){if(n[j[o]]===g){n[j[o]]={}}n=n[j[o]]}n[j[j.length-1]]=d[p]}if(b.AMDLC_TESTS){m=b.privateModules||{};for(p in d){m[p]=d[p]}for(k=0;k<l.length;k++){delete m[l[k]]}b.privateModules=m}}h("tinymce/imagetoolsplugin/Canvas",[],function(){function k(m,l){return i(document.createElement("canvas"),m,l)}function j(l){return l.getContext("2d")}function i(m,n,l){m.width=n;m.height=l;return m}return{create:k,resize:i,get2dContext:j}});h("tinymce/imagetoolsplugin/Mime",[],function(){function i(l){var k=document.createElement("a");k.href=l;return k.pathname}function j(m){var n=i(m).split("."),l=n[n.length-1],k={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png"};if(l){l=l.toLowerCase()}return k[l]}return{guessMimeType:j}});h("tinymce/imagetoolsplugin/ImageSize",[],function(){function i(k){return k.naturalWidth||k.width}function j(k){return k.naturalHeight||k.height}return{getWidth:i,getHeight:j}});h("tinymce/imagetoolsplugin/Conversions",["tinymce/util/Promise","tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/Mime","tinymce/imagetoolsplugin/ImageSize"],function(r,k,o,s){function i(x){return new r(function(z){function y(){x.removeEventListener("load",y);z(x)}if(x.complete){z(x)}else{x.addEventListener("load",y)}})}function w(x){return i(x).then(function(A){var z,y;y=k.create(s.getWidth(A),s.getHeight(A));z=k.get2dContext(y);z.drawImage(A,0,0);return y})}function j(x){return i(x).then(function(y){var z=y.src;if(z.indexOf("blob:")===0){return u(z)}if(z.indexOf("data:")===0){return n(z)}return w(y).then(function(A){return n(A.toDataURL(o.guessMimeType(z)))})})}function v(x){return new r(function(z){var A=new Image();function y(){A.removeEventListener("load",y);z(A)}A.addEventListener("load",y);A.src=URL.createObjectURL(x);if(A.complete){y()}})}function u(x){return new r(function(y){var z=new XMLHttpRequest();z.open("GET",x,true);z.responseType="blob";z.onload=function(){if(this.status==200){y(this.response)}};z.send()})}function n(x){return new r(function(D){var E,y,A,C,B,z;x=x.split(",");C=/data:([^;]+)/.exec(x[0]);if(C){B=C[1]}E=atob(x[1]);if(window.WebKitBlobBuilder){z=new WebKitBlobBuilder();y=new ArrayBuffer(E.length);for(A=0;A<y.length;A++){y[A]=E.charCodeAt(A)}z.append(y);D(z.getBlob(B));return}y=new Uint8Array(E.length);for(A=0;A<y.length;A++){y[A]=E.charCodeAt(A)}D(new Blob([y],{type:B}))})}function p(x){if(x.indexOf("blob:")===0){return u(x)}if(x.indexOf("data:")===0){return n(x)}return null}function t(x,y){return n(x.toDataURL(y))}function m(x){return new r(function(z){var y=new FileReader();y.onloadend=function(){z(y.result)};y.readAsDataURL(x)})}function l(x){return m(x).then(function(y){return y.split(",")[1]})}function q(x){URL.revokeObjectURL(x.src)}return{blobToImage:v,imageToBlob:j,uriToBlob:p,blobToDataUri:m,blobToBase64:l,imageToCanvas:w,canvasToBlob:t,revokeImageUrl:q}});h("tinymce/imagetoolsplugin/ImageTools",["tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/ImageSize"],function(n,i,m){var p=n.revokeImageUrl;function k(q,r){return n.blobToImage(q).then(function(v){var s=i.create(m.getWidth(v),m.getHeight(v)),t=i.get2dContext(s),w=0,u=0;r=r<0?360+r:r;if(r==90||r==270){i.resize(s,s.height,s.width)}if(r==90||r==180){w=s.width}if(r==270||r==180){u=s.height}t.translate(w,u);t.rotate(r*Math.PI/180);t.drawImage(v,0,0);p(v);return n.canvasToBlob(s,q.type)})}function o(q,r){return n.blobToImage(q).then(function(u){var s=i.create(m.getWidth(u),m.getHeight(u)),t=i.get2dContext(s);if(r=="v"){t.scale(1,-1);t.drawImage(u,0,-s.height)}else{t.scale(-1,1);t.drawImage(u,-s.width,0)}p(u);return n.canvasToBlob(s)})}function l(s,q,u,r,t){return n.blobToImage(s).then(function(x){var v=i.create(r,t),w=i.get2dContext(v);w.drawImage(x,-q,-u);p(x);return n.canvasToBlob(v)})}function j(r,q,s){return n.blobToImage(r).then(function(v){var t=i.create(q,s),u=i.get2dContext(t);u.drawImage(v,0,0,q,s);p(v);return n.canvasToBlob(t,r.type)})}return{rotate:k,flip:o,crop:l,resize:j}});h("tinymce/imagetoolsplugin/CropRect",["tinymce/dom/DomQuery","tinymce/ui/DragHelper","tinymce/geom/Rect","tinymce/util/Tools","tinymce/util/Observable"],function(n,m,k,j,i){var l=0;return function(y,B,z,s){var G,o,E,F,D="mce-",C=D+"crid-"+(l++);o=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1}];F=["top","right","bottom","left"];function t(K,J){return{x:J.x+K.x,y:J.y+K.y,w:J.w,h:J.h}}function A(J,K){return{x:K.x-J.x,y:K.y-J.y,w:K.w,h:K.h}}function p(){return A(z,y)}function I(){function J(L){var K;return new m(C,{document:s.ownerDocument,handle:C+"-"+L.name,start:function(){K=y},drag:function(Q){var M,R,N,O,P;M=K.x;R=K.y;N=K.w;O=K.h;M+=Q.deltaX*L.deltaX;R+=Q.deltaY*L.deltaY;N+=Q.deltaX*L.deltaW;O+=Q.deltaY*L.deltaH;if(N<20){N=20}if(O<20){O=20}P=y=k.clamp({x:M,y:R,w:N,h:O},z,L.name=="move");P=A(z,P);G.fire("updateRect",{rect:P});x(P)}})}n('<div id="'+C+'" class="'+D+'croprect-container" data-mce-bogus="all">').appendTo(s);j.each(F,function(K){n("#"+C,s).append('<div id="'+C+"-"+K+'"class="'+D+'croprect-block" style="display: none" data-mce-bogus="all">')});j.each(o,function(K){n("#"+C,s).append('<div id="'+C+"-"+K.name+'" class="'+D+"croprect-handle "+D+"croprect-handle-"+K.name+'" style="display: none" data-mce-bogus="all">')});E=j.map(o,J);q(y)}function r(K){var J;J=j.map(o,function(L){return"#"+C+"-"+L.name}).concat(j.map(F,function(L){return"#"+C+"-"+L})).join(",");if(K){n(J,s).show()}else{n(J,s).hide()}}function q(J){function K(L,M){if(M.h<0){M.h=0}if(M.w<0){M.w=0}n("#"+C+"-"+L,s).css({left:M.x,top:M.y,width:M.w,height:M.h})}j.each(o,function(L){n("#"+C+"-"+L.name,s).css({left:J.w*L.xMul+J.x,top:J.h*L.yMul+J.y})});K("top",{x:B.x,y:B.y,w:B.w,h:J.y-B.y});K("right",{x:J.x+J.w,y:J.y,w:B.w-J.x-J.w+B.x,h:J.h});K("bottom",{x:B.x,y:J.y+J.h,w:B.w,h:B.h-J.y-J.h+B.y});K("left",{x:B.x,y:J.y,w:J.x-B.x,h:J.h});K("move",J)}function w(J){y=J;q(y)}function u(J){B=J;q(y)}function x(J){w(t(z,J))}function v(J){z=J;q(y)}function H(){j.each(E,function(J){J.destroy()});E=[]}I(s);G=j.extend({toggleVisibility:r,setClampRect:v,setRect:w,getInnerRect:p,setInnerRect:x,setViewPortRect:u,destroy:H},i);return G}});h("tinymce/imagetoolsplugin/ImagePanel",["tinymce/ui/Control","tinymce/ui/DragHelper","tinymce/geom/Rect","tinymce/util/Tools","tinymce/util/Promise","tinymce/imagetoolsplugin/CropRect"],function(m,l,j,i,n,k){function o(p){return new n(function(r){function q(){p.removeEventListener("load",q);r(p)}if(p.complete){r(p)}else{p.addEventListener("load",q)}})}return m.extend({Defaults:{classes:"imagepanel"},selection:function(p){if(arguments.length){this.state.set("rect",p);return this}return this.state.get("rect")},imageSize:function(){var p=this.state.get("viewRect");return{w:p.w,h:p.h}},toggleCropRect:function(p){this.state.set("cropEnabled",p)},imageSrc:function(r){var q=this,p=new Image();p.src=r;o(p).then(function(){var u,s,t=q.state.get("viewRect");s=q.$el.find("img");if(s[0]){s.replaceWith(p)}else{q.getEl().appendChild(p)}u={x:0,y:0,w:p.naturalWidth,h:p.naturalHeight};q.state.set("viewRect",u);q.state.set("rect",j.inflate(u,-20,-20));if(!t||t.w!=u.w||t.h!=u.h){q.zoomFit()}q.repaintImage();q.fire("load")})},zoom:function(p){if(arguments.length){this.state.set("zoom",p);return this}return this.state.get("zoom")},postRender:function(){this.imageSrc(this.settings.imageSrc);return this._super()},zoomFit:function(){var q=this,r,t,x,p,s,u,v;v=10;r=q.$el.find("img");t=q.getEl().clientWidth;x=q.getEl().clientHeight;p=r[0].naturalWidth;s=r[0].naturalHeight;u=Math.min((t-v)/p,(x-v)/s);if(u>=1){u=1}q.zoom(u)},repaintImage:function(){var v,u,z,q,A,r,p,B,t,s;s=this.getEl();B=this.zoom();t=this.state.get("rect");p=this.$el.find("img");A=s.offsetWidth;r=s.offsetHeight;z=p[0].naturalWidth*B;q=p[0].naturalHeight*B;v=Math.max(0,A/2-z/2);u=Math.max(0,r/2-q/2);p.css({left:v,top:u,width:z,height:q});if(this.cropRect){this.cropRect.setRect({x:t.x*B+v,y:t.y*B+u,w:t.w*B,h:t.h*B});this.cropRect.setClampRect({x:v,y:u,w:z,h:q});this.cropRect.setViewPortRect({x:0,y:0,w:A,h:r})}},bindStates:function(){var p=this;function q(r){p.cropRect=new k(r,p.state.get("viewRect"),p.state.get("viewRect"),p.getEl());p.cropRect.on("updateRect",function(u){var t=u.rect,s=p.zoom();t={x:Math.round(t.x/s),y:Math.round(t.y/s),w:Math.round(t.w/s),h:Math.round(t.h/s)};p.state.set("rect",t)});p.on("remove",p.cropRect.destroy)}p.state.on("change:cropEnabled",function(r){p.cropRect.toggleVisibility(r.value);p.repaintImage()});p.state.on("change:zoom",function(){p.repaintImage()});p.state.on("change:rect",function(s){var r=s.value;if(!p.cropRect){q(r)}p.cropRect.setRect(r)})}})});h("tinymce/imagetoolsplugin/ColorMatrix",[],function(){function n(w,v,u){w=parseFloat(w);if(w>u){w=u}else{if(w<v){w=v}}return w}function r(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}var j=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,0.17,0.18,0.2,0.21,0.22,0.24,0.25,0.27,0.28,0.3,0.32,0.34,0.36,0.38,0.4,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.8,0.83,0.86,0.89,0.92,0.95,0.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];function k(A,z){var y,x,u,B,w=[],v=new Array(10);for(y=0;y<5;y++){for(x=0;x<5;x++){w[x]=z[x+y*5]}for(x=0;x<5;x++){B=0;for(u=0;u<5;u++){B+=A[x+u*5]*w[u]}v[x+y*5]=B}}return v}function s(u,v){v=n(v,0,1);return u.map(function(x,w){if(w%6===0){x=1-((1-x)*v)}else{x*=v}return n(x,0,1)})}function t(v,w){var u;w=n(w,-1,1);w*=100;if(w<0){u=127+w/100*127}else{u=w%1;if(u===0){u=j[w]}else{u=j[(Math.floor(w))]*(1-u)+j[(Math.floor(w))+1]*u}u=u*127+127}return k(v,[u/127,0,0,0,0.5*(127-u),0,u/127,0,0,0.5*(127-u),0,0,u/127,0,0.5*(127-u),0,0,0,1,0,0,0,0,0,1])}function l(v,z){var u,y,w,A;z=n(z,-1,1);u=1+((z>0)?3*z:z);y=0.3086;w=0.6094;A=0.082;return k(v,[y*(1-u)+u,w*(1-u),A*(1-u),0,0,y*(1-u),w*(1-u)+u,A*(1-u),0,0,y*(1-u),w*(1-u),A*(1-u)+u,0,0,0,0,0,1,0,0,0,0,0,1])}function q(u,A){var z,x,w,v,y;A=n(A,-180,180)/180*Math.PI;z=Math.cos(A);x=Math.sin(A);w=0.213;v=0.715;y=0.072;return k(u,[w+z*(1-w)+x*(-w),v+z*(-v)+x*(-v),y+z*(-y)+x*(1-y),0,0,w+z*(-w)+x*(0.143),v+z*(1-v)+x*(0.14),y+z*(-y)+x*(-0.283),0,0,w+z*(-w)+x*(-(1-w)),v+z*(-v)+x*(v),y+z*(1-y)+x*(y),0,0,0,0,0,1,0,0,0,0,0,1])}function p(u,v){v=n(255*v,-255,255);return k(u,[1,0,0,0,v,0,1,0,0,v,0,0,1,0,v,0,0,0,1,0,0,0,0,0,1])}function m(v,x,w,u){x=n(x,0,2);w=n(w,0,2);u=n(u,0,2);return k(v,[x,0,0,0,0,0,w,0,0,0,0,0,u,0,0,0,0,0,1,0,0,0,0,0,1])}function o(u,v){v=n(v,0,1);return k(u,s([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],v))}function i(u,v){v=n(v,0,1);return k(u,s([0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],v))}return{identity:r,adjust:s,multiply:k,adjustContrast:t,adjustBrightness:p,adjustSaturation:l,adjustHue:q,adjustColors:m,adjustSepia:o,adjustGrayscale:i}});h("tinymce/imagetoolsplugin/Filters",["tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/ImageSize","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/ColorMatrix"],function(i,p,q,o){var m=q.revokeImageUrl;function n(u,t){return q.blobToImage(u).then(function(y){var w=i.create(p.getWidth(y),p.getHeight(y)),x=i.get2dContext(w),z;function v(F,G){var P=F.data,E,L,T,W,I,D=G[0],C=G[1],B=G[2],A=G[3],ab=G[4],aa=G[5],Z=G[6],X=G[7],U=G[8],R=G[9],Y=G[10],V=G[11],S=G[12],Q=G[13],O=G[14],N=G[15],M=G[16],K=G[17],J=G[18],H=G[19];for(I=0;I<P.length;I+=4){E=P[I];L=P[I+1];T=P[I+2];W=P[I+3];P[I]=E*D+L*C+T*B+W*A+ab;P[I+1]=E*aa+L*Z+T*X+W*U+R;P[I+2]=E*Y+L*V+T*S+W*Q+O;P[I+3]=E*N+L*M+T*K+W*J+H}return F}x.drawImage(y,0,0);m(y);z=v(x.getImageData(0,0,w.width,w.height),t);x.putImageData(z,0,0);return q.canvasToBlob(w)})}function s(u,t){return q.blobToImage(u).then(function(A){var w=i.create(p.getWidth(A),p.getHeight(A)),y=i.get2dContext(w),x,z;function v(M,G,P){var H,V,C,F,K,J,O,T,U,E,D,R,Q,I,B,L,S;function N(Y,X,W){if(Y>W){Y=W}else{if(Y<X){Y=X}}return Y}C=Math.round(Math.sqrt(P.length));F=Math.floor(C/2);H=M.data;V=G.data;L=M.width;S=M.height;for(J=0;J<S;J++){for(K=0;K<L;K++){O=T=U=0;for(D=0;D<C;D++){for(E=0;E<C;E++){R=N(K+E-F,0,L-1);Q=N(J+D-F,0,S-1);I=(Q*L+R)*4;B=P[D*C+E];O+=H[I]*B;T+=H[I+1]*B;U+=H[I+2]*B}}I=(J*L+K)*4;V[I]=N(O,0,255);V[I+1]=N(T,0,255);V[I+2]=N(U,0,255)}}return G}y.drawImage(A,0,0);m(A);x=y.getImageData(0,0,w.width,w.height);z=y.getImageData(0,0,w.width,w.height);z=v(x,z,t);y.putImageData(z,0,0);return q.canvasToBlob(w)})}function r(t){return function(u,v){return q.blobToImage(u).then(function(B){var w=i.create(p.getWidth(B),p.getHeight(B)),y=i.get2dContext(w),C,x,A=new Array(256);function z(G,E){var F=G.data,D;for(D=0;D<F.length;D+=4){F[D]=E[F[D]];F[D+1]=E[F[D+1]];F[D+2]=E[F[D+2]]}return G}for(x=0;x<A.length;x++){A[x]=t(x,v)}y.drawImage(B,0,0);m(B);C=z(y.getImageData(0,0,w.width,w.height),A);y.putImageData(C,0,0);return q.canvasToBlob(w)})}}function j(t){return function(u,v){return n(u,t(o.identity(),v))}}function l(t){return function(u){return n(u,t)}}function k(t){return function(u){return s(u,t)}}return{invert:l([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:j(o.adjustBrightness),hue:j(o.adjustHue),saturate:j(o.adjustSaturation),contrast:j(o.adjustContrast),grayscale:j(o.adjustGrayscale),sepia:j(o.adjustSepia),colorize:function(u,w,v,t){return n(u,o.adjustColors(o.identity(),w,v,t))},sharpen:k([0,-1,0,-1,5,-1,0,-1,0]),emboss:k([-2,-1,0,-1,1,1,0,1,2]),gamma:r(function(t,u){return Math.pow(t/255,1-u)*255}),exposure:r(function(t,u){return 255*(1-Math.exp(-(t/255)*u))}),colorFilter:n,convoluteFilter:s}});h("tinymce/imagetoolsplugin/UndoStack",[],function(){return function(){var m=[],k=-1;function o(p){var q;q=m.splice(++k);m.push(p);return{state:p,removed:q}}function i(){if(l()){return m[--k]}}function j(){if(n()){return m[++k]}}function l(){return k>0}function n(){return k!=-1&&k<m.length-1}return{data:m,add:o,undo:i,redo:j,canUndo:l,canRedo:n}}});h("tinymce/imagetoolsplugin/Dialog",["tinymce/dom/DOMUtils","tinymce/util/Tools","tinymce/util/Promise","tinymce/ui/Factory","tinymce/ui/Form","tinymce/ui/Container","tinymce/imagetoolsplugin/ImagePanel","tinymce/imagetoolsplugin/ImageTools","tinymce/imagetoolsplugin/Filters","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/UndoStack"],function(r,m,q,i,p,j,o,x,v,s,u){function w(y){return{blob:y,url:URL.createObjectURL(y)}}function l(y){if(y){URL.revokeObjectURL(y.url)}}function k(y){m.each(y,l)}function n(ae,ab,af){var aw,P=new u(),I,T,H,S,aj,ah,W,ap,V,F,L,an,ai,ar,R,E,aq,az,ay,ao,D,Q,y,C,al,au;function X(aF){var aC,aE,aD,aB;aC=aw.find("#w")[0];aE=aw.find("#h")[0];aD=parseInt(aC.value(),10);aB=parseInt(aE.value(),10);if(aw.find("#constrain")[0].checked()&&y&&C&&aD&&aB){if(aF.control.settings.name=="w"){aB=Math.round(aD*al);aE.value(aB)}else{aD=Math.round(aB*au);aC.value(aD)}}y=aD;C=aB}function av(aB){return Math.round(aB*100)+"%"}function K(){aw.find("#undo").disabled(!P.canUndo());aw.find("#redo").disabled(!P.canRedo());aw.statusbar.find("#save").disabled(!P.canUndo())}function M(){aw.find("#undo").disabled(true);aw.find("#redo").disabled(true)}function O(aB){if(aB){W.imageSrc(aB.url)}}function at(aB){return function(){var aC=m.grep(Q,function(aD){return aD.settings.name!=aB});m.each(aC,function(aD){aD.hide()});aB.show()}}function N(aB){H=w(aB);O(H)}function ax(aB){ae=w(aB);O(ae);k(P.add(ae).removed);K()}function A(){var aB=W.selection();x.crop(ae.blob,aB.x,aB.y,aB.w,aB.h).then(function(aC){ax(aC);G()})}function ad(aC){var aB=[].slice.call(arguments,1);return function(){var aD=H||ae;aC.apply(this,[aD.blob].concat(aB)).then(N)}}function B(aC){var aB=[].slice.call(arguments,1);return function(){aC.apply(this,[ae.blob].concat(aB)).then(ax)}}function G(){O(ae);l(H);at(I)();K()}function Z(){if(H){ax(H.blob);G()}}function ak(){var aB=W.zoom();if(aB<2){aB+=0.1}W.zoom(aB)}function Y(){var aB=W.zoom();if(aB>0.1){aB-=0.1}W.zoom(aB)}function ag(){ae=P.undo();O(ae);K()}function U(){ae=P.redo();O(ae);K()}function aa(){ab(ae.blob);aw.close()}function z(aB){return new p({layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:aB})}function ac(aC,aB){return z([{text:"Back",onclick:G},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:Z}]).hide().on("show",function(){M();aB(ae.blob).then(function(aE){var aD=w(aE);O(aD);l(H);H=aD})})}function am(aF,aD,aE,aC,aB){function aG(aH){aD(ae.blob,aH).then(function(aJ){var aI=w(aJ);O(aI);l(H);H=aI})}return z([{text:"Back",onclick:G},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(aH){aG(aH.value)},minValue:aC,maxValue:aB,value:aE,previewFilter:av},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:Z}]).hide().on("show",function(){this.find("slider").value(aE);M()})}function J(aC,aB){function aD(){var aG,aF,aE;aG=aw.find("#r")[0].value();aF=aw.find("#g")[0].value();aE=aw.find("#b")[0].value();aB(ae.blob,aG,aF,aE).then(function(aI){var aH=w(aI);O(aH);l(H);H=aH})}return z([{text:"Back",onclick:G},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:aD,previewFilter:av},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:aD,previewFilter:av},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:aD,previewFilter:av},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:Z}]).hide().on("show",function(){aw.find("#r,#g,#b").value(1);M()})}S=z([{text:"Back",onclick:G},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:A}]).hide().on("show hide",function(aB){W.toggleCropRect(aB.type=="show")}).on("show",M);function aA(aB){if(aB.control.value()===true){al=C/y;au=y/C}}aj=z([{text:"Back",onclick:G},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:X},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:X},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:true,onchange:aA},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(aD){var aC=parseInt(aw.find("#w").value(),10),aB=parseInt(aw.find("#h").value(),10);aD.preventDefault();B(x.resize,aC,aB)();G()}).on("show",M);ah=z([{text:"Back",onclick:G},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:ad(x.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:ad(x.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:ad(x.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:ad(x.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:Z}]).hide().on("show",M);F=ac("Invert",v.invert);az=ac("Sharpen",v.sharpen);ay=ac("Emboss",v.emboss);L=am("Brightness",v.brightness,0,-1,1);an=am("Hue",v.hue,180,0,360);ai=am("Saturate",v.saturate,0,-1,1);ar=am("Contrast",v.contrast,0,-1,1);R=am("Grayscale",v.grayscale,0,0,1);E=am("Sepia",v.sepia,0,0,1);aq=J("Colorize",v.colorize);ao=am("Gamma",v.gamma,0,-1,1);D=am("Exposure",v.exposure,1,0,2);T=z([{text:"Back",onclick:G},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:at(an)},{text:"saturate",icon:"saturate",onclick:at(ai)},{text:"sepia",icon:"sepia",onclick:at(E)},{text:"emboss",icon:"emboss",onclick:at(ay)},{text:"exposure",icon:"exposure",onclick:at(D)},{type:"spacer",flex:1}]).hide();I=z([{tooltip:"Crop",icon:"crop",onclick:at(S)},{tooltip:"Resize",icon:"resize2",onclick:at(aj)},{tooltip:"Orientation",icon:"orientation",onclick:at(ah)},{tooltip:"Brightness",icon:"sun",onclick:at(L)},{tooltip:"Sharpen",icon:"sharpen",onclick:at(az)},{tooltip:"Contrast",icon:"contrast",onclick:at(ar)},{tooltip:"Color levels",icon:"drop",onclick:at(aq)},{tooltip:"Gamma",icon:"gamma",onclick:at(ao)},{tooltip:"Invert",icon:"invert",onclick:at(F)}]);W=new o({flex:1,imageSrc:ae.url});ap=new j({layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:ag},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:U},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:ak},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:Y}]});V=new j({type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[ap,W]});Q=[I,S,aj,ah,T,F,L,an,ai,ar,R,E,aq,az,ay,ao,D];aw=i.create("window",{layout:"flex",direction:"column",align:"stretch",minWidth:Math.min(r.DOM.getViewPort().w,800),minHeight:Math.min(r.DOM.getViewPort().h,650),title:"Edit image",items:Q.concat([V]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:aa},{text:"Cancel",onclick:"close"}]});aw.renderTo(document.body).reflow();aw.on("close",function(){af();k(P.data);P=null;H=null});P.add(ae);K();W.on("load",function(){y=W.imageSize().w;C=W.imageSize().h;al=C/y;au=y/C;aw.find("#w").value(y);aw.find("#h").value(C)})}function t(y){return new q(function(A,z){n(w(y),A,z)})}return{edit:t}});h("tinymce/imagetoolsplugin/Plugin",["tinymce/PluginManager","tinymce/Env","tinymce/util/Promise","tinymce/util/URI","tinymce/util/Tools","tinymce/util/Delay","tinymce/imagetoolsplugin/ImageTools","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/Dialog"],function(k,l,n,p,j,i,q,o,m){k.add("imagetools",function(v){var B=0,J,E;if(!l.fileApi){return}function G(R){var S,Q;function T(U){return U.indexOf("px")==U.length-2}S=R.style.width;Q=R.style.height;if(S||Q){if(T(S)&&T(Q)){return{w:parseInt(S,10),h:parseInt(Q,10)}}return null}S=v.$(R).attr("width");Q=v.$(R).attr("height");if(S&&Q){return{w:parseInt(S,10),h:parseInt(Q,10)}}return null}function t(R,S){var T,Q;if(S){T=R.style.width;Q=R.style.height;if(T||Q){v.$(R).css({width:S.w,height:S.h}).removeAttr("data-mce-style")}T=R.width;Q=R.height;if(T||Q){v.$(R).attr({width:S.w,height:S.h})}}}function N(Q){return{w:Q.naturalWidth,h:Q.naturalHeight}}function D(){return v.selection.getNode()}function u(){return"imagetools"+B++}function M(Q){var R=Q.src;return R.indexOf("data:")===0||R.indexOf("blob:")===0||new p(R).host===v.documentBaseURI.host}function r(Q){return j.inArray(v.settings.imagetools_cors_hosts,new p(Q.src).host)!==-1}function P(Q){return new n(function(R){var S=new XMLHttpRequest();S.onload=function(){R(this.response)};S.open("GET",Q,true);S.responseType="blob";S.send()})}function L(Q){var R=Q.src;if(r(Q)){return P(Q.src)}if(!M(Q)){R=v.settings.imagetools_proxy;R+=(R.indexOf("?")===-1?"?":"&")+"url="+encodeURIComponent(Q.src);Q=new Image();Q.src=R}return o.imageToBlob(Q)}function I(){var Q;Q=v.editorUpload.blobCache.getByUri(D().src);if(Q){return Q}return L(D()).then(function(R){return o.blobToBase64(R).then(function(S){var U=v.editorUpload.blobCache;var T=U.create(u(),R,S);U.add(T);return T})})}function A(){J=i.setEditorTimeout(v,function(){v.editorUpload.uploadImagesAuto()},30000)}function w(){clearTimeout(J)}function x(Q,R){return o.blobToDataUri(Q).then(function(S){var X,T,W,U,V;V=D();X=u();W=v.editorUpload.blobCache;T=p.parseDataUri(S).data;U=W.create(X,Q,T);W.add(U);v.undoManager.transact(function(){function Y(){v.$(V).off("load",Y);v.nodeChanged();if(R){v.editorUpload.uploadImagesAuto()}else{w();A()}}v.$(V).on("load",Y);v.$(V).attr({src:U.blobUri()}).removeAttr("data-mce-src")});return U})}function F(Q){return function(){return v._scanForImages().then(I).then(Q).then(x)}}function K(Q){return function(){return F(function(S){var R=G(D());if(R){t(D(),{w:R.h,h:R.w})}return q.rotate(S.blob(),Q)})()}}function z(Q){return function(){return F(function(R){return q.flip(R.blob(),Q)})()}}function C(){var Q=D(),R=N(Q);if(Q){L(Q).then(m.edit).then(function(S){return new n(function(T){o.blobToImage(S).then(function(V){var U=N(V);if(R.w!=U.w||R.h!=U.h){if(G(Q)){t(Q,U)}}URL.revokeObjectURL(V.src);T(S)})})}).then(function(S){x(S,true)},function(){})}}function s(){v.addButton("rotateleft",{title:"Rotate counterclockwise",onclick:K(-90)});v.addButton("rotateright",{title:"Rotate clockwise",onclick:K(90)});v.addButton("flipv",{title:"Flip vertically",onclick:z("v")});v.addButton("fliph",{title:"Flip horizontally",onclick:z("h")});v.addButton("editimage",{title:"Edit image",onclick:C});v.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"})}function H(){v.on("NodeChange",function(Q){if(E&&E.src!=Q.element.src){w();v.editorUpload.uploadImagesAuto();E=g}if(y(Q.element)){E=Q.element}})}function y(Q){var R=v.dom.is(Q,"img:not([data-mce-object],[data-mce-placeholder])");return R&&(M(Q)||r(Q)||v.settings.imagetools_proxy)}function O(){var Q=v.settings.imagetools_toolbar;if(!Q){Q="rotateleft rotateright | flipv fliph | crop editimage imageoptions"}v.addContextToolbar(y,Q)}s();O();H();v.addCommand("mceEditImage",C)})});a(["tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/Mime","tinymce/imagetoolsplugin/ImageSize","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/ImageTools","tinymce/imagetoolsplugin/CropRect","tinymce/imagetoolsplugin/ImagePanel","tinymce/imagetoolsplugin/ColorMatrix","tinymce/imagetoolsplugin/Filters","tinymce/imagetoolsplugin/UndoStack","tinymce/imagetoolsplugin/Dialog","tinymce/imagetoolsplugin/Plugin"])})(this);